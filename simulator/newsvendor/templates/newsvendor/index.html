{% load static %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Login</title>
            <meta charset="UTF-8">
            <link href="{% static 'newsvendor/index.css' %}" rel="stylesheet">
            <meta name="viewport" content="width=device-width, initial-scale=1">
          
    </head>
    <body>
        <section id='main'>
            
            <form>
                {% csrf_token %}
            <section id=first >
                <div class="logo">
                   <p><h1 style="text-align: left; color: rgb(10, 10, 10);font-style:italic;">Decomposed Newsvendor Model
                    <img src="{% static 'newsvendor/logo.png' %}"  alt="logo" style="vertical-align:middle;float: right;"></h1></p> 
                </div>
    
                <div class="topnav">
                   <p> </p> 
                </div>
    
                <div>
                    <h1 style="font-style:italic;">Thanks for accepting our request!</h1>
                </div>
                

                <div class="intro">
                    <h3>
                        Introduction:Task Decomposition and Newsvendor Decision Making
                    </h3>
                    <h5>
                        In three behavioral laboratory experiments, we compare newsvendor ordering decisions made directly tonewsvendor ordering decisions made in a decomposed way by soliciting point forecasts, uncertainty judgments,and service level decisions. Decomposing orders in such a way can lead to performance improvements comparedto ordering directly. However, we also demonstrate that if the underlying demand uncertainty is too high, or if thecost structure emphasizes underage costs, decomposition may fail as a decision approach. Under such conditions,decision makers are prone to incorporate too much random judgment error or set service levels too high, whichreduces the efficacy of this decision approach. We further demonstrate that if accompanied by decision support inthe form of suggested quantities, task decomposition becomes the better performing approach to decision makingmore generally. Decision support and task decomposition therefore appear as complementary methods to improvedecision performance
                    </h5>    
                </div>
                <div>
                    <button onclick="document.getElementById('ethics').style.display='block'" style="width:auto;">Read Ethics</button>
                </div>
                <section id='ethics' class="modal">
                    <div class="modal-content">
                            <h2>Ethics </h2>
                        <div style="border:3px solid rgb(0, 183, 255) ;margin: auto;">
                            <p>The overflow property specifies whether to clip content or to add scrollbars when an element's content is too big to fit in a specified area.</p>
                            <p>The overflow property specifies whether to clip content or to add scrollbars when an element's content is too big to fit in a specified area.</p>
                            <p>The overflow property specifies whether to clip content or to add scrollbars when an element's content is too big to fit in a specified area.</p>
                            <p>The overflow property specifies whether to clip content or to add scrollbars when an element's content is too big to fit in a specified area.</p>
                            <p>The overflow property specifies whether to clip content or to add scrollbars when an element's content is too big to fit in a specified area.</p>
                            <p>The overflow property specifies whether to clip content or to add scrollbars when an element's content is too big to fit in a specified area.</p>
                            <p>The overflow property specifies whether to clip content or to add scrollbars when an element's content is too big to fit in a specified area.</p>
                        </div>
                        <div>
                            <button onclick="document.getElementById('ethics').style.display='none'" style="width:auto;">Close</button>
                        </div>
                    </div> 
                </section>
                <div>
                    <h4>This survey takes approximately 5 mins.</h4>
                </div>
                <div class="footer">
                    <h3><label for="email">Enter your Email:</label>
                    <input type="email" id="email" name="email">
                    <p><button id="firstsubmit" style="width:auto;">Next</button></p>
                    </h3>
                </div>
            </section>

            <section id="second">
                <div class="logo">
                    <p><h1 style="text-align: left; color: rgb(10, 10, 10);font-style:italic;">Decomposed Newsvendor Model
                     <img src="{% static 'newsvendor/logo.png' %}"  alt="logo" style="vertical-align:middle;float: right;"></h1></p> 
                 </div>
     
                 <div class="topnav">
                    <p> </p> 
                 </div>

                <h1 style="text-align: center;">Demographics</h1>
                 
                <div class="card">
                    <img src={% static 'newsvendor/demographics1.png' %} alt="Demographics" style="width:100%">
                    <div class="container">
                        <label for="name">Enter your Name</label>
                        <input type="text" id="name" name="name">
                        <div class="row">
                            <div class="column">
                                <div>
                                <p><label for="gender">Please select your gender:</label></p>
                                <select id="gender" name="gender"  >
                                    <option disabled selected value> -- select an option -- </option>
                                    <option value="male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                  </select>
                                </div>
        
                                <div>
                                 <p><label for="gender">Please select your age:</label></p> 
                                 <input type="number" id="age" name="age" min = "1">
                                  <!--<select id="age" name="age">
                                    <option disabled selected value> -- select an option -- </option>
                                      <option value="age1">0 - 30</option>
                                      <option value="age2">31 - 60</option>
                                      <option value="age3">61 - 100</option>
                                    </select> -->
                                </div>
        
                            </div>
                            <div class="column">
                                <div>
                               <p><label for="organisation">Please select your organisation:</label></p> 
                                <select id="organisation" name="organisation">
                                    <option disabled selected value> -- select an option -- </option>
                                    <option value="Management">Management</option>
                                    <option value="Engineering">Engineering</option>
                                    <option value="Other">Other</option>
                                  </select>
                                </div>
                                <div>
                                
                                <p> <label for="designation">Please select your designation:</label></p>   
                                <select id="designation" name="designation">
                                    <option disabled selected value> -- select an option -- </option>
                                    <option value="Student">Student</option>
                                    <option value="Professor">Professor</option>
                                    <option value="Other">Other</option>
                                  </select>
                                </div>
                            </div>
                        </div>
                    </div>
                  </div>


                <p><button id="secondsubmit" style="width:auto;">Next</button></p> 
            </section>

            <section id="third">
                
                <div class="logo">
                    <p><h1 style="text-align: left; color: rgb(10, 10, 10);font-style:italic;">Decomposed Newsvendor Model
                     <img src="{% static 'newsvendor/logo.png' %}"  alt="logo" style="vertical-align:middle;float: right;"></h1></p> 
                 </div>
     
                 <div class="topnav">
                    <p> </p> 
                 </div>
                
                
                <div class="row">
                    <div class="column">
                        <div style="align-content:left;">
                            <h1><p><label style="text-align: left;">Round :  </label><label id="round" style="text-align:left">1</label></p></h1>
                        </div>
                        <div class="card">
                            <img id="plot" style="width:500px;height:300px;" src="{% static 'newsvendor/plots/1.png' %}" alt="Scatterplot">
                            <div class="container">
                                <div id="even">
                                    <table style="width:100%">
                                        <tr>
                                            <td>
                                                <h4> <label>Underage Cost:</label>
                                                    <p> <label id="CU">CU</label></p></h4>
                                            </td>
                                            <td>
                                                <h4><label>Overage Cost:</label>
                                                    <p><label id="CO">CO</label></p></h4>
                                        </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                          </div>
                          

                    </div>
                    
                
                    <div class="column" >

                        <div class="card">
                           
                            <!-- <div class="container"> -->
                                <table style="width:100%; margin-top:100px;">
                                    <tr>
        
                                        <td>
                                            <p><h3><label for="forecast">Point Forecast</label>
                                                <input type="number" id="forecast" name="point_forecast"></h3></p>    
                                        </td>
                                        <td>
                                            <h3><p><label for="LB">Lower Bound</label>
                                                <input type="number" id="LB" name="LB" onchange="calculate()"> 
                                                </p></h3>
                                        </td>
                                    </tr>
                                        <td>
                                            <h3><p><label for="UB">Upper Bound</label>
                                                <input type="number" id="UB" name="UB" onclick="show_cost()">
                                                </p></h3>
                                        </td>
                                        <td>
                                            <p><h3><label for="fill">Target Fill Rate</label>
                                                <input type="number" id="fill" name="target_fil_rate" ></h3></p>
                                        </td>
                                    </tr>
                                </table>
                            <!-- </div> -->
                          </div>

                        <!-- <table style="width:100%; margin-top:100px;">
                            <tr>

                                <td>
                                    <p><h3><label for="forecast">Point Forecast</label>
                                        <input type="number" id="forecast" name="point_forecast"></h3></p>    
                                </td>
                                <td>
                                    <h3><p><label for="LB">Lower Bound</label>
                                        <input type="number" id="LB" name="LB" onchange="calculate()"> 
                                        </p></h3>
                                </td>
                            </tr>
                                <td>
                                    <h3><p><label for="UB">Upper Bound</label>
                                        <input type="number" id="UB" name="UB" onclick="show_cost()">
                                        </p></h3>
                                </td>
                                <td>
                                    <p><h3><label for="fill">Target Fill Rate</label>
                                        <input type="number" id="fill" name="target_fil_rate" ></h3></p>
                                </td>
                            </tr>
                        </table> -->

                        <p><button id="roundSub" style="width:auto;">Next</button></p>
                        </table>
                    </div>
                    
                </div>
                
            </section>
            </form>

        </section>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script>
            let pic = ["{% static 'newsvendor/plots/1.png' %}","{% static 'newsvendor/plots/2.png' %}","{% static 'newsvendor/plots/3.png' %}","{% static 'newsvendor/plots/4.png' %}","{% static 'newsvendor/plots/5.png' %}",];
            let imageNumber = 0;
            change_image=function()
            {
                imageNumber=(imageNumber+1)%pic.length;
                document.getElementById("plot").src=pic[imageNumber];
            }
            calculate=function()
            {
                var t=document.getElementById('LB').value;
                var mean=document.getElementById('forecast').value;
                document.getElementById('UB').value=Math.round(Math.exp(2*Math.log(mean)-Math.log(t)));
            }

            show_cost=function()
            {
                // if(document.getElementById('even').style.display=='None'){
                    document.getElementById('even').style.display="block";
                // }
            }
            var user=new Object();
            

            document.addEventListener('DOMContentLoaded',()=>{
                var modal=document.getElementById('ethics');
                window.onclick=function(event){
                if(event.target==modal){
                    modal.style.display="none";
                }
                return false;
            }

            document.getElementById('firstsubmit').onclick=function(){
                
                user.email=document.getElementById('email').value;
                $.ajax(
                {
                    type:"GET",
                    url: "/decomposednv/checkEmail",
                    data:{
                             email: user.email
                    },
                    success: function( data ) 
                    {
                        if(data=='False')
                        {
                            document.getElementById('first').style.display='none';
                            document.getElementById('second').style.display='block';
                        }
                        else
                        {
                            document.getElementById('email').value='';
                            alert("You have already taken the survey. ")
                        }
                    }
                 })
                return false;
            }
            
            
            document.getElementById('secondsubmit').onclick=function(){
                 
                user.email=document.getElementById('email').value;
                user.name=document.getElementById("name").value;
                user.gender=document.getElementById('gender').value;
                user.age=document.getElementById('age').value;
                user.organisation=document.getElementById('organisation').value;
                user.designation=document.getElementById('designation').value;
                $.ajax(
                {
                    type:"GET",
                    url: "/decomposednv/userSubmit",
                    data:{
                            email:user.email,
                            name:user.name,
                            gender:user.gender,
                            age:user.age,
                            organisation:user.organisation,
                            designation:user.designation,
                    },
                    success: function( data ) 
                    {
                            uid = data['uid'];
                            currqid = data['qid'];
                            document.getElementById('second').style.display='none';
                            document.getElementById('third').style.display='block';
                            document.getElementById('CU').innerHTML=data['CU'];
                            document.getElementById('CO').innerHTML=data['CO'];
                            document.getElementById('round').innerHTML=data['qid'];

                            
                    }
                })
                return false;
            }

            document.getElementById('roundSub').onclick=function(){

                var question=new Object();
                question.forecast=document.getElementById('forecast').value;
                question.LB=document.getElementById('LB').value;
                question.UB=document.getElementById('UB').value;
                question.fill=document.getElementById('fill').value;

                $.ajax(
                {
                    type:"GET",
                    url: "/decomposednv/roundSubmit",
                    data:{
                        uid:uid,
                        qid:currqid,
                        point_forecast:question.forecast,
                        LB:question.LB,
                        UB:question.UB,
                        target_fill_rate:question.fill   
                    },
                    success: function( data ) 
                    {
                            document.getElementById('third').style.display='block';
                            document.getElementById('CU').innerHTML=data['CU'];
                            document.getElementById('CO').innerHTML=data['CO'];
                            document.getElementById('round').innerHTML=data['qid'];
                            currqid = data['qid']

                            change_image();
                            document.getElementById('forecast').value="";
                            document.getElementById('LB').value="";
                            document.getElementById('UB').value="";
                            document.getElementById('fill').value="";

                            if(data.even==false){
                                document.getElementById('even').style.display="block";
                            }
                            else if(data.even==true){
                                document.getElementById('even').style.display="none";
                            }
                            else{
                                alert("Thank you for taking part in the survey. You will be receiving an email shortly");
                                location.reload();
                            }
                    },
                    error: function(XMLHttpRequest, textStatus, errorThrown) 
                    { 
                        alert("Status: " + textStatus); alert("Error: " + errorThrown); 
                    }   
                })
                return false;
            }
        
            })
        </script>
    </body>
</html>